{"remainingRequest":"/home/encima/.nvm/versions/node/v11.0.0/lib/node_modules/@vue/cli-service-global/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/encima/dev/uzh/shared-components/src/components/RegisterForm.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/home/encima/dev/uzh/shared-components/src/components/RegisterForm.vue","mtime":1573386383384},{"path":"/home/encima/.nvm/versions/node/v11.0.0/lib/node_modules/@vue/cli-service-global/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/encima/.nvm/versions/node/v11.0.0/lib/node_modules/@vue/cli-service-global/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/encima/dev/uzh/shared-components/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/encima/dev/uzh/shared-components/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/encima/.nvm/versions/node/v11.0.0/lib/node_modules/@vue/cli-service-global/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAnQC9zdHlsZXMvdGhlbWUuc2Nzcyc7CkBpbXBvcnQgJ0Avc3R5bGVzL3NoYXJlZC92YXJpYWJsZXMuc2Nzcyc7CgouZXJyb3IgewogICAgY29sb3I6ICRjb2xvci1lcnJvcjsKfQoK"},{"version":3,"sources":["RegisterForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6RA;AACA;;AAEA;AACA;AACA","file":"RegisterForm.vue","sourceRoot":"src/components","sourcesContent":["<i18n>\n    {\n\n    \"en\": {\n\n    \"label-email\": \"Email\",\n    \"label-password\": \"Password\",\n    \"label-password-repeat\": \"Repeat Password\",\n\n    \"button-register\": \"Register\",\n\n    \"error-empty\": \"Enter an email address.\",\n    \"error-email\": \"Email already in use.\",\n    \"error-email-format\": \"No valid email address\",\n    \"error-username\": \"Username already in use.\",\n    \"error-len\": \"Password needs to be at least 8 characters long.\",\n    \"error-match\": \"Passwords don't match.\",\n    \"error-server\": \"Server error occured\",\n\n    \"notifications-label\": \"Notifications\",\n    \"notifications-option-1\": \"I want to receive information about the Citizen Science Center Zurich.\",\n    \"notifications-option-2\": \"I want to receive information about this project.\"\n\n    },\n\n    \"de\": {\n\n    \"label-email\": \"Email\",\n    \"label-password\": \"Passwort\",\n    \"label-password-repeat\": \"Passwort wiederholen\",\n\n    \"button-register\": \"Registrieren\",\n\n    \"error-empty\": \"Sie müssen eine E-Mail angeben.\",\n    \"error-email\": \"Email bereits registriert.\",\n    \"error-email-format\": \"Keine gültige E-Mail.\",\n    \"error-username\": \"Benutzername bereits vergeben.\",\n    \"error-len\": \"Muss mehr als 8 Zeichen lang sein.\",\n    \"error-match\": \"Passwörter stimmen nicht überein.\",\n    \"error-server\": \"Serverfehler aufgetreten.\",\n\n    \"notifications-label\": \"Benachrichtigungen\",\n    \"notifications-option-1\": \"Ich möchte Informationen zum Citizen Science Center Zurich erhalten.\",\n    \"notifications-option-2\": \"Ich möchte Informationen zu diesem Projekt erhalten.\"\n\n    }\n\n    }\n</i18n>\n\n\n<template>\n\n    <form @submit.prevent=\"register\">\n        <div class=\"form-field form-field-block\">\n            <label for=\"reg-email\">{{ $t(\"label-email\") }}</label>\n            <input v-model=\"email\" type=\"email\" id=\"reg-email\" name=\"reg-email\" autocomplete=\"new-password\" :disabled=\"loading\" />\n            <span class=\"message error\" v-if=\"errors.empty\">{{ $t(\"error-empty\") }}</span>\n            <span class=\"message error\" v-if=\"errors.emailFormat\">{{ $t(\"error-email-format\") }}</span>\n            <span class=\"message error\" v-if=\"errors.email\">{{ $t(\"error-email\") }}</span>\n        </div>\n        <div class=\"form-field form-field-block\">\n            <label for=\"reg-username\">Username</label>\n            <input v-model=\"username\" id=\"reg-username\" name=\"reg-email\" autocomplete=\"new-password\" :disabled=\"loading\" />\n            <span class=\"message error\" v-if=\"errors.username\">{{ $t(\"error-username\") }}</span>\n        </div>\n        <div class=\"form-field form-field-block\">\n            <label for=\"reg-password\">{{ $t(\"label-password\") }}</label>\n            <input v-model=\"password\" type=\"password\" id=\"reg-password\" name=\"reg-password\" autocomplete=\"new-password\" :disabled=\"loading\"/>\n            <span class=\"message error\" v-if=\"errors.len\">{{ $t(\"error-len\") }}</span>\n        </div>\n        <div class=\"form-field form-field-block\">\n            <label for=\"reg-password-2\">{{ $t(\"label-password-repeat\") }}</label>\n            <input v-model=\"confPassword\" type=\"password\" id=\"reg-password-2\" name=\"reg-password-2\" autocomplete=\"new-password\" :disabled=\"loading\"/>\n            <span class=\"message error\" v-if=\"errors.match\">{{ $t(\"error-match\") }}</span>\n        </div>\n\n        <div class=\"form-field form-field-block\">\n            <label for=\"notification-options\">{{ $t(\"notifications-label\") }}</label>\n            <div class=\"options\" id=\"notification-options\">\n\n                <label>\n                    <input type=\"checkbox\" v-model=\"checkbox1\">\n                    <div class=\"checkbox\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                            <path d=\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\"></path>\n                        </svg>\n                    </div>\n                    <span>{{ $t(\"notifications-option-1\") }}</span>\n                </label>\n\n                <label v-if=\"projectId !== '667461b5-353e-4dae-b83b-c59b0563133b'\">\n                    <input type=\"checkbox\" v-model=\"checkbox2\">\n                    <div class=\"checkbox\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                            <path d=\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\"></path>\n                        </svg>\n                    </div>\n                    <span>{{ $t(\"notifications-option-2\") }}</span>\n                </label>\n\n            </div>\n        </div>\n\n        <div class=\"button-group right-aligned\">\n            <button :disabled=\"loading || !email || !password || errors.email || errors.empty || errors.len || errors.match || errors.password || errors.username\" type=\"submit\" class=\"button button-primary\">{{ $t(\"button-register\") }}</button>\n        </div>\n\n        <div class=\"form-message form-message-error\" v-if=\"errors.server\">\n            <div class=\"icon\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n                    <path d=\"M322.72,256,422.79,155.93a31.46,31.46,0,0,0,0-44.48L400.55,89.21a31.46,31.46,0,0,0-44.48,0L256,189.28,155.93,89.21a31.46,31.46,0,0,0-44.48,0L89.21,111.45a31.46,31.46,0,0,0,0,44.48L189.28,256,89.21,356.07a31.46,31.46,0,0,0,0,44.48l22.24,22.24a31.46,31.46,0,0,0,44.48,0L256,322.72,356.07,422.79a31.46,31.46,0,0,0,44.48,0l22.24-22.24a31.46,31.46,0,0,0,0-44.48Z\"></path>\n                </svg>\n            </div>\n            <span class=\"text\">{{ $t(\"error-server\") }}</span>\n        </div>\n    </form>\n\n</template>\n\n<script>\n    import {mapState} from \"vuex\"\n\n    export default {\n        name: \"RegisterForm\",\n        data() {\n            return {\n                email: \"\",\n                username: '',\n                password: \"\",\n                confPassword: \"\",\n                checkbox1: true,\n                checkbox2: true,\n                userSaved: false,\n                errors: {\n                    empty: false,\n                    emailFormat: false,\n                    email: false,\n                    username: false,\n                    match: false,\n                    len: false,\n                    server: false\n                },\n                emailCheckTimeout: undefined,\n                usernameCheckTimeout: undefined\n            };\n        },\n        computed: mapState({\n            loading: state => state.settings.loading,\n            projectId: state => state.consts.projectId\n        }),\n        watch: {\n            email() {\n                this.username = this.email.split('@')[0];\n\n                this.errors.email = false;\n                clearTimeout( this.emailCheckTimeout );\n                var self = this;\n                this.emailCheckTimeout = setTimeout( function() {\n                    self.checkEmailFormat();\n                    self.checkEmail();\n                }, 500);\n            },\n            username() {\n                this.errors.username = false;\n                clearTimeout( this.usernameCheckTimeout );\n                var self = this;\n                this.usernameCheckTimeout = setTimeout( function() {\n                    self.checkUsername();\n                }, 500);\n            },\n            password() {\n                if( this.password.length < 8 ) {\n                    this.errors.len = true;\n                }\n                else {\n                    this.errors.len = false;\n                }\n            },\n            confPassword() {\n                if( this.confPassword !== this.password ) {\n                    this.errors.match = true;\n                }\n                else {\n                    this.errors.match = false;\n                }\n            }\n        },\n        methods: {\n            checkUsername() {\n                let query = {\n                    'select': {\n                        'fields': [\n                            '*'\n                        ],\n                        'tables': [\n                            'users'\n                        ]\n                    },\n                    'where': [\n                        {\n                            \"field\": 'username',\n                            'op': 'e',\n                            'val': this.username\n                        }\n                    ]\n                };\n                this.$store.dispatch('c3s/submission/getSubmissions', [query, 1] ).then(res => {\n                    if( res.body.length > 0 ) {\n                        // email already registered\n                        this.errors.username = true;\n                    }\n\n                    //this.$store.commit('c3s/user/SET_ANON', true);\n                });\n            },\n            checkEmailFormat() {\n                var re = /\\S+@\\S+\\.\\S+/;\n                if( re.test(this.email) ) {\n                    this.errors.emailFormat = false;\n                }\n                else {\n                    this.errors.emailFormat = true;\n                }\n            },\n            checkEmail() {\n                let query = {\n                    'select': {\n                        'fields': [\n                            '*'\n                        ],\n                        'tables': [\n                            'users'\n                        ]\n                    },\n                    'where': [\n                        {\n                            \"field\": 'email',\n                            'op': 'e',\n                            'val': this.email\n                        }\n                    ]\n                };\n                this.$store.dispatch('c3s/submission/getSubmissions', [query, 1] ).then(res => {\n                    if( res.body.length > 0 ) {\n                        // email already registered\n                        this.errors.email = true;\n                    }\n                });\n            },\n            register() {\n                this.errors.server = false;\n                this.errors.username = false;\n\n                const user = {\n                    email: this.email,\n                    username: this.username,\n                    pwd: this.password,\n                    info: {\n                        'anonymous': false,\n                        'center-notifications': this.checkbox1\n                    }\n                };\n\n                if( this.projectId && this.checkbox2 ) {\n                    user.info['project-notifications'] = [ this.projectId ];\n                }\n\n                this.$store.dispatch('c3s/user/register', user).then(r => {\n\n                    if (r.ok === true) {\n                        this.$router.push('/');\n                    }\n                    else {\n                        this.errors.server = true;\n                    }\n                });\n            }\n        }\n    };\n</script>\n\n<style lang=\"scss\">\n\n\n    @import '@/styles/theme.scss';\n    @import '@/styles/shared/variables.scss';\n\n    .error {\n        color: $color-error;\n    }\n\n</style>\n"]}]}